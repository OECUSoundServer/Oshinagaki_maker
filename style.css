:root{
  --font: "Noto Sans JP", system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN","Yu Gothic", sans-serif;
  --base-pt: 11pt;

  --paper-w: 210mm;
  --paper-h: 297mm;
  --margin: 10mm;

  --band: #d98181;
  --band-height: 6mm;
  --band-inset: 0mm;

  --new: #e53935;

  --pad: 10mm;
  --content-scale: 1;

  --section-gap: 8mm;
  --items-gap: 4mm;

  --card-large-min: 70mm;
  --card-small-min: 42mm;

  --item-border-width: 0.3mm;
  --item-border-color: #111;
  --item-border-visible: 1;

  --price-style: box;    /* box | pill | text | none */
  --tag-style: outline;  /* outline | filled | none */

  --cols-large: 0;       /* 0 = 自動 */
  --cols-small: 0;       /* 0 = 自動 */
  --grid-justify: start; /* start | center | end（自動時のみ有効） */

  /* 背景（CSS変数で管理） */
  --paper-bg-color: #ffffff;
  --paper-bg-image: none;              /* url("...") or none */
  --paper-bg-size: cover;              /* cover | contain | auto */
  --paper-bg-repeat: no-repeat;        /* no-repeat | repeat */
  --paper-bg-position: center center;  /* 常に中央基準 */
}

* { box-sizing: border-box; }
html,body { height: 100%; }
body {
  margin: 0;
  font-family: var(--font);
  font-size: var(--base-pt);
  color: #111;
  background: #f3f3f5;
}

/* アプリバー */
.appbar {
  position: sticky; top: 0; z-index: 3;
  display:flex; justify-content:space-between; align-items:center;
  gap: 12px; padding: 8px 12px; background:#fff; border-bottom:1px solid #e5e5ea;
}
.appbar .brand { font-weight: 900; letter-spacing: .02em; }
.appbar .actions { display:flex; gap:8px; flex-wrap:wrap; align-items:center; }

/* 共通UI */
.panel button.accent{ background:#f0f7ff; border:1px solid #bcd7ff; }
.panel button.primary{ background:#ecfff3; border:1px solid #b6e9c7; }
.panel button.danger{ background:#fff0f0; border:1px solid #f3b6b6; }
.edit-indicator{ padding:4px 8px; background:#fff8d1; border:1px solid #f0e2a2; border-radius:6px; width:max-content; }

/* サイド/メイン */
.main { display:grid; grid-template-columns: 380px 1fr; gap: 16px; padding: 16px; }

/* サイドパネル：中だけ縦スクロール。横は出さない */
.panel{
  background:#fff;
  border:1px solid #e5e5ea;
  border-radius:12px;
  padding:12px;

  position: sticky;
  top: 64px;
  max-height: calc(100vh - 64px - 16px);
  overflow-y: auto;     /* ← 縦だけ */
  overflow-x: hidden;   /* ← 横は隠す */
  overscroll-behavior: contain;
  scrollbar-gutter: stable;
}
.panel .row-inline{ display:flex; gap:8px; flex-wrap: wrap; }
.panel .row-inline > *{ min-width: 0; }
.panel input[type="text"], .panel input[type="number"], .panel input[type="url"], .panel select, .panel textarea{
  width: 100%; max-width: 100%;
  padding:8px; border:1px solid #ddd; border-radius:8px; font: inherit;
}
.section-list{ list-style:none; margin:8px 0 0; padding:0; }
.section-list li{ display:flex; align-items:center; gap:8px; padding:6px 8px; border:1px solid #eee; border-radius:8px; background:#fafafa; margin-bottom:6px; }
.section-list li .name[contenteditable]{ padding:2px 4px; border-radius:4px; }
.section-list li .btn-del{ margin-left:auto; cursor:pointer; border:1px solid #ddd; border-radius:6px; background:#fff; padding:4px 8px; }

.canvas-wrap { display:flex; flex-direction:column; align-items:center; gap:8px; }
.tips { font-size: 12px; opacity: .7; }

/* 用紙：背景はCSS変数を使う（PNG時の色ズレ回避にも有効） */
.paper {
  width: var(--paper-w);
  height: var(--paper-h);
  position: relative;
  overflow: hidden;

  /* 背景指定 */
  background-color: var(--paper-bg-color);
  background-image: var(--paper-bg-image);
  background-size: var(--paper-bg-size);
  background-repeat: var(--paper-bg-repeat);
  background-position: var(--paper-bg-position);

  box-shadow: 0 6px 24px rgba(0,0,0,.08);
}
.paper.landscape { width: var(--paper-h); height: var(--paper-w); }
/* 書き出し時は影を消す（背景がくすむのを防ぐ） */
.paper.exporting { box-shadow: none !important; }

/* セーフエリア可視化 */
.safe { position:absolute; inset: var(--margin); outline: 0.3mm dashed rgba(0,0,0,.3); pointer-events:none; display:none; }
.paper.show-safe .safe { display:block; }
.grid { position:absolute; inset:0; pointer-events:none; background-image:
  linear-gradient(to right, rgba(0,0,0,.06) 1px, transparent 1px),
  linear-gradient(to bottom, rgba(0,0,0,.06) 1px, transparent 1px);
  background-size: 5mm 5mm; display:none;
}
.paper.show-grid .grid { display:block; }

/* 安全枠内コンテンツ（自動×手動スケール） */
.content{ position:absolute; inset: var(--margin); }
.content-inner{
  transform-origin: top left;
  transform: scale(var(--content-scale));
  width: calc(100% / var(--content-scale));
  min-height: calc(100% / var(--content-scale));
}

/* ヘッダー */
.header { padding: var(--pad) var(--pad) 2mm; position: relative; }
.header-row { display:grid; grid-template-columns: 1fr auto 1fr; align-items:center; gap: 6mm; }
.logo { display:flex; align-items:center; min-height: 20pt; }
.logo-text { font-weight: 900; font-size: calc(var(--base-pt) * 1.64); display:block; }
.logo-img { display:none; max-height: 22mm; max-width: 60mm; object-fit: contain; }
.logo.image .logo-text { display:none; }
.logo.image .logo-img  { display:block; }
.spaceno{ font-weight: 900; font-size: calc(var(--base-pt) * 1.64); text-align:center; }
.title  { font-weight: 900; font-size: calc(var(--base-pt) * 1.82); text-align:right; }

/* 帯（幅・太さ・位置調整） */
.band-wrap { position: relative; margin-top: 3mm; height: var(--band-height); }
.band { position:absolute; left: var(--band-inset); right: var(--band-inset); height: 100%; background: var(--band); border-radius: 1mm; }
.band-label {
  position:absolute; top:50%; left:50%; transform: translate(-50%,-50%);
  font-weight:700; background:#ffffff00; padding: 1mm 2.5mm; border-radius: 1.2mm; border: .3mm solid #1111; white-space: nowrap;
}

/* セクション */
.section { padding: var(--section-gap) var(--pad) 0; }
.section:first-of-type{ padding-top: 4mm; }
.section h2 { font-size: calc(var(--base-pt) * 1.45); margin: 0 0 3mm; border-bottom: .4mm solid #111; display:inline-block; padding-right: 2mm; }

/* ===== アイテム・グリッド（列数/寄せ対応） ===== */
.section .items{
  list-style:none; margin:0; padding:0;
  display:grid; gap: var(--items-gap);
  justify-content: var(--grid-justify); /* 自動時：start|center|end */
}
/* 自動（data-cols="0"） */
.section[data-size="large"][data-cols="0"] .items{
  grid-template-columns: repeat(auto-fit, minmax(var(--card-large-min), var(--card-large-min)));
}
.section[data-size="small"][data-cols="0"] .items{
  grid-template-columns: repeat(auto-fit, minmax(var(--card-small-min), var(--card-small-min)));
}
/* 列数固定（>0） */
.section[data-size="large"]:not([data-cols="0"]) .items{
  grid-template-columns: repeat(var(--cols-large), minmax(0, 1fr));
  justify-content: stretch;
}
.section[data-size="small"]:not([data-cols="0"]) .items{
  grid-template-columns: repeat(var(--cols-small), minmax(0, 1fr));
  justify-content: stretch;
}

/* カード */
.item{
  border: calc(var(--item-border-width) * var(--item-border-visible)) solid var(--item-border-color);
  border-radius: 1.2mm; padding: 2mm; position: relative; background:#fff;
  overflow: hidden; cursor: pointer;
}
.item .thumb{
  width: 100%;
  aspect-ratio: 1 / 1;
  object-fit: cover;
  display:block;
  border-radius: .8mm;
}

/* 右に説明 */
.item.layout-right{
  display:grid;
  grid-template-columns: 40mm 1fr;
  gap: 3mm;
  align-items:start;
}
.item.layout-right .thumb{ aspect-ratio:1/1; width: 40mm; }
.item.layout-right .caption{ margin-top: 0; }

/* タイトルは説明より大きく */
.item .caption { margin-top: 1.5mm; font-weight:800; font-size: calc(var(--base-pt) * 1.25); }
.item .desc{
  margin-top: 1mm; font-size: calc(var(--base-pt) * .95); line-height: 1.5; color: #333;
}

/* メタタグ（ページ/曲＋オリジナルタグ）— outline/filled/none */
.item .meta{ margin-top: .6mm; font-size: calc(var(--base-pt) * .88); color: #555; display:flex; gap: 3mm; flex-wrap:wrap; }
.item .meta .tag{
  border: .25mm solid #bbb; border-radius: .9mm; padding: .4mm 1.4mm; white-space: nowrap; background: transparent;
}
:root[style*="--tag-style: filled"] .item .meta .tag{ background: #eee; border-color: #ddd; }
:root[style*="--tag-style: none"]  .item .meta .tag{ border: none; background: transparent; padding: 0; }

/* 価格ラベル（box/pill/text/none） */
.item .price {
  position:absolute; right: 1.5mm; bottom: 1.5mm;
  background:#fff; padding: .8mm 1.4mm;
  border: .3mm solid #111; border-radius: .8mm; font-weight:900; font-size: calc(var(--base-pt) * 0.95);
}
:root[style*="--price-style: pill"] .item .price{ border-radius: 3mm; }
:root[style*="--price-style: text"] .item .price{ background: transparent; border: none; padding: 0; }
:root[style*="--price-style: none"] .item .price{ display: none; }

/* NEW バッジ（左上） */
.item .badge {
  position:absolute; left: -2mm; top: 2mm; background: var(--new); color: #fff;
  padding: .6mm 2mm; font-weight:900; font-size: calc(var(--base-pt) * 0.9);
  border-radius: 1mm; transform: rotate(-6deg); box-shadow: 0 0.6mm 0 rgba(0,0,0,.2); z-index:1;
}
.item .badge-img { position:absolute; left: 2mm; top: 2mm; width: 12mm; height: 12mm; object-fit: contain; pointer-events:none; }

/* R18 / R18G バッジ（右上・縦積み） */
.item .badge-r18{
  position:absolute; right: 2mm; top: 2mm; background:#c62828; color:#fff;
  padding:.6mm 2mm; font-weight:900; font-size: calc(var(--base-pt) * .9);
  border-radius:1mm; z-index:1;
}
.item .badge-r18g{
  position:absolute; right: 2mm; top: 12mm; background:#4a148c; color:#fff;
  padding:.6mm 2mm; font-weight:900; font-size: calc(var(--base-pt) * .9);
  border-radius:1mm; z-index:1;
}
.item .badge-img-r18{
  position:absolute; right: 2mm; top: 2mm; width:12mm; height:12mm; object-fit:contain; pointer-events:none; z-index:1;
}
.item .badge-img-r18g{
  position:absolute; right: 2mm; top: 14mm; width:12mm; height:12mm; object-fit:contain; pointer-events:none; z-index:1;
}

/* フッター */
.footer { display:flex; justify-content: space-between; align-items:center; gap: 6mm; padding: 2mm var(--pad) 10mm; }
.footer .note  { font-weight:700; font-size: calc(var(--base-pt) * 1.0); }
.qr { width: 22mm; height: 22mm; border: .3mm solid #111; border-radius: 1mm; display:flex; align-items:center; justify-content:center; overflow:hidden; }

/* 印刷 */
@media print {
  @page { size: A4 portrait; margin: 0; }
  body { background: #fff; }
  .appbar, .panel, .tips { display:none !important; }
  .paper { box-shadow:none; margin:0; }
}
