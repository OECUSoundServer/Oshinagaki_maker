<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>お品書きメーカー（テスト版）</title>

  <!-- Google Fonts -->
  <link id="gf" rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap" />
  <link rel="stylesheet" href="style.css" />

  <!-- 依存CDN（順序重要：ライブラリ → app.js） -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>
</head>
<body>
  <header class="appbar">
    <div class="brand">お品書きメーカー</div>
    <div class="actions">
      <button id="btn-export-png">PNG書き出し</button>
      <button id="btn-print">印刷 / PDF</button>
    </div>
  </header>

  <main class="main">
    <aside class="panel">
      <section>
        <h3>用紙設定</h3>
        <label>サイズ
          <select id="paper-size">
            <option value="A3">A3</option>
            <option value="A4" selected>A4</option>
            <option value="A5">A5</option>
          </select>
        </label>
        <label>向き
          <select id="paper-orientation">
            <option value="portrait" selected>縦</option>
            <option value="landscape">横</option>
          </select>
        </label>
        <label>余白(mm)
          <input id="paper-margin" type="number" min="0" step="1" value="10" />
        </label>
        <label class="chk"><input id="safe-area" type="checkbox" checked /> セーフエリア表示</label>
        <label class="chk"><input id="grid" type="checkbox" /> 5mmグリッド</label>
      </section>

      <section>
        <h3>フォント / 文字サイズ</h3>
        <label>フォント
          <select id="font-family">
            <option value="Noto Sans JP" selected>Noto Sans JP</option>
            <option value="M PLUS 1p">M PLUS 1p</option>
            <option value="Kosugi Maru">Kosugi Maru（丸ゴ）</option>
            <option value="Shippori Mincho">Shippori Mincho（明朝）</option>
          </select>
        </label>
        <label>基準サイズ（pt）
          <input id="base-pt" type="number" min="8" max="24" step="1" value="11" />
        </label>
      </section>

      <section>
        <h3>背景</h3>
        <label>背景の種類
          <select id="bg-mode">
            <option value="none">なし（透明/白）</option>
            <option value="color" selected>単色</option>
            <option value="image">画像</option>
          </select>
        </label>

        <div id="bg-color-wrap">
          <label>背景色
            <input id="bg-color" type="color" value="#ffffff" />
          </label>
        </div>

        <div id="bg-image-wrap" style="display:none">
          <label>画像ソース
            <select id="bg-image-source">
              <option value="file" selected>アップロード</option>
              <option value="url">URL</option>
            </select>
          </label>
          <div id="bg-image-file-row">
            <label>背景画像（アップロード）<input id="bg-image-file" type="file" accept="image/*" /></label>
          </div>
          <div id="bg-image-url-row" style="display:none">
            <label>背景画像URL<input id="bg-image-url" type="url" placeholder="https://..." /></label>
            <small class="tips">※ PNG書き出し時はCORS対応が必要です（印刷/PDFはOK）。</small>
          </div>
          <label>表示方法
            <select id="bg-fit">
              <option value="cover" selected>画面いっぱい（切り抜き）</option>
              <option value="contain">全体表示（余白あり）</option>
              <option value="tile">タイル（繰り返し）</option>
            </select>
          </label>
        </div>
      </section>

      <section>
        <h3>レイアウト調整</h3>
        <label>手動スケール（%）
          <input id="content-scale" type="range" min="80" max="120" step="1" value="100" />
        </label><br>
        <small class="tips">※ 自動スケールで安全枠に収め、さらに手動スケールで微調整できます。</small>
      </section>

      <section>
        <h3>ヘッダー</h3>
        <label>ロゴ表示
          <select id="logo-mode">
            <option value="text" selected>テキスト</option>
            <option value="image">画像</option>
          </select>
        </label>
        <div id="logo-text-wrap">
          <label>サークル名（テキスト）
            <input id="circle-name" type="text" placeholder="Cadente など" />
          </label>
        </div>
        <div id="logo-image-wrap" style="display:none">
          <label>ロゴ画像
            <input id="circle-logo" type="file" accept="image/*" />
          </label><br>
          <small class="tips">推奨: 600×200px程度の透明PNG</small>
        </div>
        <label>スペースNo.<input id="space-no" type="text" placeholder="K-11 など" /></label>
        <label>タイトル<input id="title" type="text" placeholder="頒布物一覧 など" /></label>
        <label>帯色<input id="band-color" type="color" value="#d98181" /></label>

        <div class="row-inline">
          <label style="flex:1">帯の太さ(mm)
            <input id="band-height" type="number" min="2" step="0.5" value="6" />
          </label>
          <label style="flex:1">帯の左右余白(mm)
            <input id="band-inset" type="number" min="0" step="0.5" value="0" />
          </label>
        </div>

        <label>帯ラベル<input id="band-label" type="text" value="イベント名など" /></label>
      </section>

      <section>
        <h3>セクション管理</h3>
        <div class="row-inline">
          <input id="new-section-name" type="text" placeholder="例: 新譜 / 既刊 / グッズ" />
          <button id="btn-add-section">追加</button>
        </div>
        <ul id="section-list" class="section-list"></ul>

        <div class="row-inline">
          <label style="flex:1">セクション間の縦間隔(mm)
            <input id="section-gap" type="number" min="0" step="1" value="8" />
          </label>
          <label style="flex:1">カード間の間隔(mm)
            <input id="items-gap" type="number" min="0" step="1" value="4" />
          </label>
        </div>
        <div class="row-inline">
          <label style="flex:1">大カード最小幅(mm)
            <input id="card-large-min" type="number" min="40" step="1" value="70" />
          </label>
          <label style="flex:1">小カード最小幅(mm)
            <input id="card-small-min" type="number" min="30" step="1" value="42" />
          </label>
        </div>

        <!-- 列数/寄せ -->
        <div class="row-inline">
          <label style="flex:1">大カード 列数（0=自動）
            <input id="cols-large" type="number" min="0" step="1" value="0" />
          </label>
          <label style="flex:1">小カード 列数（0=自動）
            <input id="cols-small" type="number" min="0" step="1" value="0" />
          </label>
        </div>
        <label>横揃え
          <select id="grid-align">
            <option value="start" selected>左</option>
            <option value="center">中央</option>
            <option value="end">右</option>
          </select>
        </label>

        <small class="tips">※ 小カードの幅は大カードの最小幅を超えないよう自動制限されます。</small>
      </section>

      <section>
        <h3>アイテム追加 / 編集</h3>
        <div id="edit-indicator" class="edit-indicator" hidden>編集中</div>

        <label>区分
          <select id="sec"></select>
        </label>

        <label>画像ソース
          <select id="item-image-source">
            <option value="file" selected>アップロード</option>
            <option value="url">URL</option>
          </select>
        </label>
        <div id="item-image-file-wrap">
          <label>画像（アップロード）<input id="item-image" type="file" accept="image/*" /></label>
        </div>
        <div id="item-image-url-wrap" style="display:none">
          <label>画像URL<input id="item-image-url" type="url" placeholder="https://..." /></label>
          <small class="tips">※ PNG書き出し時はCORS対応が必要です（印刷/PDFはOK）。</small>
        </div>

        <label>タイトル<input id="item-title" type="text" /></label>
        <label>価格（空なら非表示）<input id="item-price" type="text" placeholder="500円 など" /></label>

        <!-- NEW / R18 / R18G バッジ（画像対応） -->
        <label class="chk"><input id="item-isnew" type="checkbox" /> NEWバッジを付ける</label><br>
        <label>NEWバッジ画像（任意）
          <input id="item-badge-image" type="file" accept="image/*" />
        </label><br>

        <label class="chk"><input id="item-isr18" type="checkbox" /> R18バッジを付ける</label><br>
        <label>R18バッジ画像（任意）
          <input id="item-badge-r18-image" type="file" accept="image/*" />
        </label><br>

        <label class="chk"><input id="item-isr18g" type="checkbox" /> R18Gバッジを付ける</label><br>
        <label>R18Gバッジ画像（任意）
          <input id="item-badge-r18g-image" type="file" accept="image/*" />
        </label><br>

        <label>説明（任意）
          <textarea id="item-desc" rows="3" placeholder="商品説明・収録内容など"></textarea>
        </label>
        <label>説明の配置
          <select id="item-layout">
            <option value="below" selected>画像の下</option>
            <option value="right">画像の右</option>
          </select>
        </label>
        <div class="row-inline">
          <label style="flex:1">ページ数（任意）
            <input id="item-pages" type="number" min="0" placeholder="例：36" />
          </label>
          <label style="flex:1">曲数（任意）
            <input id="item-tracks" type="number" min="0" placeholder="例：10" />
          </label>
        </div>

        <!-- オリジナルタグ -->
        <label>オリジナルタグ（カンマ区切り）
          <input id="item-custom-tags" type="text" placeholder="既刊, 旧譜, グッズ など" />
        </label>

        <div class="row-inline">
          <button id="btn-add-item" class="accent">追加</button>
          <button id="btn-update-item" class="primary" hidden>更新</button>
          <button id="btn-cancel-edit" hidden>編集キャンセル</button>
          <button id="btn-delete-item" class="danger" hidden>削除</button>
        </div>
      </section>

      <section>
        <h3>見た目</h3>
        <label class="chk"><input id="item-border-on" type="checkbox" checked /> アイテムの枠線を表示</label>
        <label>枠線の太さ（mm）
          <input id="item-border-width" type="number" min="0" step="0.1" value="0.3" />
        </label>

        <label>価格ラベル
          <select id="price-style">
            <option value="box" selected>ボックス</option>
            <option value="pill">ピル（丸）</option>
            <option value="text">テキストのみ</option>
            <option value="none">非表示</option>
          </select>
        </label>
        <label>メタタグ（ページ/曲）
          <select id="tag-style">
            <option value="outline" selected>アウトライン</option>
            <option value="filled">塗りつぶし</option>
            <option value="none">線なし</option>
          </select>
        </label>
      </section>

      <section>
        <h3>QR / 注記</h3>
        <label>QRリンクURL<input id="qr-url" type="url" placeholder="https://example.com" /></label>
        <button id="btn-make-qr">QR生成</button>
        <label>注記テキスト<textarea id="note" rows="3" placeholder="その他詳細はWebへ など"></textarea></label>
      </section>
    </aside>

    <!-- 右：編集キャンバス -->
    <section class="canvas-wrap">
      <div id="paper" class="paper a4 portrait">
        <div class="safe"></div>
        <div class="grid"></div>

        <!-- 安全枠内 -->
        <div class="content">
          <div class="content-inner">

            <div class="header">
              <div class="header-row">
                <div class="logo">
                  <div class="logo-text" contenteditable="true">Cadente</div>
                  <img class="logo-img" alt="logo" />
                </div>
                <div class="spaceno" contenteditable="true">K-11</div>
                <div class="title" contenteditable="true">頒布物一覧</div>
              </div>

              <div class="band-wrap">
                <div class="band"></div>
                <div class="band-label" contenteditable="true">音楽CD</div>
              </div>
            </div>

            <div id="sections-root"></div>

            <div class="footer">
              <div class="note" id="note-view" contenteditable="true">その他頒布物の詳細はコチラ→</div>
              <div id="qr" class="qr"></div>
            </div>

          </div>
        </div>
        <!-- /安全枠内 -->

      </div>
      <div class="tips">※ クリックでアイテム編集。自動スケールで常に安全枠内に収まります。</div>
    </section>
  </main>

  <script src="app.js"></script>
</body>
</html>
